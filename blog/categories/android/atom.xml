<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Android | kurobaraのブログ]]></title>
  <link href="http://moonstruckdrops.github.com/blog/categories/android/atom.xml" rel="self"/>
  <link href="http://moonstruckdrops.github.com/"/>
  <updated>2013-04-24T23:58:04+09:00</updated>
  <id>http://moonstruckdrops.github.com/</id>
  <author>
    <name><![CDATA[kurobara]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Androidのソースコード検索サービスを構築してみる]]></title>
    <link href="http://moonstruckdrops.github.com/blog/2013/03/25/gnu-global/"/>
    <updated>2013-03-25T12:17:00+09:00</updated>
    <id>http://moonstruckdrops.github.com/blog/2013/03/25/gnu-global</id>
    <content type="html"><![CDATA[<p>色々経緯(長いような長くないようなもの)があるわけでして、構築してみることにしました。<br/>
とりあえず、aospのmasterで構築してみます。</p>

<h4>環境</h4>

<hr />

<ul>
<li>Ubuntu12.04 x86_64</li>
<li><a href="http://www.gnu.org/software/global/">GNU Global 6.2.8</a></li>
<li>Apache2</li>
</ul>


<p>GNU Globalのバージョンは、なるべく新しいものを入れるようにします。。。<br/>
Ubuntuのapt-getでインストールもできますが、ソースコードを解析した結果が正しくgenerateされません。<br/>
6.2.8だと正しく解析できました。(公式もdebianで配布しているパッケージは古いと記載があったので、Ubuntuも同じ感じでしょう)</p>

<h4>事前準備</h4>

<hr />

<p>事前準備として、以下を実施します。</p>

<ul>
<li>GNU Globalのインストール</li>
<li>Apache2のインストール</li>
<li>Androidのソースコードをダウンロード</li>
</ul>


<h6>GNU Globalのインストール</h6>

<hr />

<p>前述のように、UbuntuのリポジトリにあるGNU Globalは古いのでソースコードの解析が正しく行われません。<br/>
そのため、ビルドしてインストールします。</p>

<ol>
<li>ソースコードの取得(<a href="http://www.gnu.org/software/global/">ここ</a>からダウンロード)</li>
<li>ビルド(ここではデフォルト設定で行います)
<code>
$./configure --prefix=/usr/local/global
$make
</code></li>
<li>インストール
<code>
$sudo make install
</code>
ビルドの際に付与するオプションはご自身で設定してください。</li>
</ol>


<h6>Apache2のインストール</h6>

<hr />

<p>普通にインストールします。
<code>
$sudo apt-get install apache2
</code></p>

<p>UbuntuっていうかDebian系使いづらいなぁ・・・。</p>

<h6>Androidのソースコード取得</h6>

<hr />

<p>(公式)[]にしたがって実施します。<br/>
今回は「/var/aosp」のディレクトリ配下に保存することとします。</p>

<h4>コード解析(タグ作成)の実施</h4>

<hr />

<p>以下のコマンドで実行します</p>

<p><code>
$cd /var/aosp
$gtags -v
</code></p>

<h4>タグのHtml化</h4>

<hr />

<p>以下のコマンドで実行します。</p>

<p>```
$cd /var/aosp
$htags -afsnDvo --title Android --item-order=s --show-position --fixed-guid --auto-completion</p>

<p>```</p>

<p>非常に長いオプションですが、ソースコード検索フォームのhtmlが生成されます。<br/>
検索に加えて、検索フォームの上で入力補完をできるようにしていますので、CGIの実行が必要です。</p>

<h4>Apache2の設定</h4>

<hr />

<p>以下のコマンドでブラウザから参照可能なディレクトリを作成します。
<code>
$mkdir -p /var/www/aosp
</code></p>

<p>コンテンツの配備を実施します。<br/>
特に意図はないですが、コピーだとめんどいのでシンボリックリンクにします。
<code>
$cd /var/www/aosp
$ln -s ../aosp/HTML HTML
</code></p>

<p>/etc/apache2/sites-enable/defaultsを編集します。</p>

<p>```
ScriptAlias /cgi-bin/ /var/www/aosp/HTML
<Directory "</var/www/aosp/HTML/cgi-bin"></p>

<pre><code>AllowOverride None
Options +ExecCGI
AddHandler cgi-script .cgi .pl
Order allow,deny
Allow from all
</code></pre>

<p></Directory>
```</p>

<p>編集完了後、apache2を再起動します。
<code>
$/etc/init.d/apache2 restart
</code></p>

<p>ブラウザ上で<a href="http://localhost/aosp">http://localhost/aosp</a>にアクセスして、画面が表示されることを確認します。</p>

<h4>感想</h4>

<hr />

<p><a href="https://sites.google.com/site/devcollaboration/codesearch">こういうサービス</a>が、既に世の中にある訳で・・・</p>

<p>自分がやる必要ってあんまりないんじゃないかなーとか。。。</p>
]]></content>
  </entry>
  
</feed>
